name: Docker Image CI

on:
  workflow_dispatch

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag az2003.azurecr.io/docker-app:actions
    - name: Log in to Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.CREDS }}
  
    - name: Build and deploy Container App
      uses: azure/container-apps-deploy-action@v1
      with:
        acrName: az2003
        containerAppName: aca-az2003
        resourceGroup: AZ-2003
        imageToDeploy: az2003.azurecr.io/docker-app:actions
